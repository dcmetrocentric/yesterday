<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Yesterday</title>
<style>
:root{--bg:#F2F0EA;--card:#fff;--ink:#0F172A;--muted:#64748B;--line:#E7E2D8;--radius:20px}
*{box-sizing:border-box}
body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--ink);display:flex;justify-content:center;padding:14px 12px 24px}
.shell{width:min(760px,100%)}
.hero{border-radius:var(--radius);border:1px solid var(--line);background:linear-gradient(135deg,rgba(31,78,121,.14),rgba(43,108,176,.08));padding:14px;margin-bottom:10px}
.hero h1{margin:2px 0;font-size:24px;font-weight:950}
.hero .lead{font-size:12px;font-weight:800;color:rgba(15,23,42,.7)}
.hero .meta{font-size:11px;color:var(--muted);font-weight:800}
.timer{margin-top:6px;font-weight:900;font-size:12px}
.card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);overflow:hidden}
.grid{padding:12px;display:grid;gap:10px;grid-template-columns:repeat(2,1fr)}
.flip{aspect-ratio:1/1;perspective:1200px}
.flipInner{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform .5s;cursor:pointer;border-radius:18px}
.flip[data-flipped="true"] .flipInner{transform:rotateY(180deg)}
.face{position:absolute;inset:0;border-radius:18px;overflow:hidden;border:1px solid var(--line);backface-visibility:hidden;background:#fff}
.front img{width:100%;height:100%;object-fit:cover;display:block}
.front .veil{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.05),rgba(0,0,0,.5))}
.front .tag{position:absolute;left:10px;top:10px;background:rgba(255,255,255,.9);padding:5px 9px;border-radius:999px;font-size:11px;font-weight:900}
.back{transform:rotateY(180deg);padding:12px;display:flex;align-items:center;justify-content:center;text-align:left}
.back p{margin:0;font-size:13px;line-height:1.45;font-weight:650}
.play{padding:12px;border-top:1px solid var(--line);background:rgba(242,240,234,.6)}
.play h2{margin:0 0 8px;font-size:12px;letter-spacing:.12em;text-transform:uppercase}
.row{display:flex;gap:8px;flex-wrap:wrap}
.inputWrap{flex:1;display:flex;align-items:center;background:#fff;border:1px solid var(--line);border-radius:12px;padding:8px 10px}
input{border:0;outline:none;width:100%;font-size:15px}
button{background:#0F172A;color:#fff;border:1px solid #0F172A;border-radius:12px;padding:10px 12px;font-weight:900}
button:disabled{opacity:.5}
.ghost{background:#fff;color:#0F172A;border:1px solid var(--line)}
.panel{margin-top:10px;padding:10px;border:1px solid var(--line);border-radius:14px;background:#fff}
.count{font-size:11px;color:var(--muted);font-weight:800;margin-top:6px}
.error{display:none;color:#7D2020;font-size:12px;margin-top:6px}

/* modal */
.modal{position:fixed;inset:0;background:rgba(15,23,42,.55);display:none;align-items:center;justify-content:center;padding:18px}
.modal .box{width:min(560px,100%);background:#fff;border-radius:18px;border:1px solid var(--line);padding:16px}
.modal h3{margin:0 0 6px;font-size:20px}
.modal .streak{font-weight:900;margin-bottom:8px}
.shareBox{white-space:pre-wrap;font-family:ui-monospace,monospace;font-size:13px;background:#f7f6f2;border-radius:12px;padding:10px;border:1px solid var(--line);margin-top:8px}
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:10px}
.stat{border:1px solid var(--line);border-radius:12px;padding:8px;text-align:center}
.stat b{display:block;font-size:16px}
.bar{height:8px;background:#eee;border-radius:999px;overflow:hidden;margin-top:6px}
.bar span{display:block;height:100%;background:#0F172A}
</style>
</head>
<body>
<div class="shell">
  <div class="hero">
    <div class="lead">Yesterday‚Ä¶</div>
    <h1>What city was this?</h1>
    <div class="meta" id="puzzleId"></div>
    <div class="timer" id="timer"></div>
  </div>

  <div class="card">
    <div class="grid" id="grid"></div>

    <div class="play">
      <h2>Guess the city</h2>
      <div class="row">
        <div class="inputWrap"><input id="guessInput" placeholder="Type a city" autocomplete="off" list="citylist"><datalist id="citylist"></datalist></div>
        <button id="submitBtn">Submit</button>
        <button class="ghost" id="revealBtn">Reveal</button>
      </div>
      <div class="count" id="count">0/5 guesses</div>
      <div class="error" id="error">Unknown city. Try a major city (e.g., London, Tokyo).</div>
      <div class="panel" id="feedback" style="display:none"></div>
    </div>
  </div>
</div>

<div class="modal" id="modal">
  <div class="box">
    <h3 id="resultTitle"></h3>
    <div class="streak" id="streakText"></div>
    <div class="shareBox" id="shareBox"></div>

    <div class="stats">
      <div class="stat"><div>Played</div><b id="sPlayed">0</b></div>
      <div class="stat"><div>Win %</div><b id="sWin">0</b></div>
      <div class="stat"><div>Current</div><b id="sCur">0</b></div>
      <div class="stat"><div>Max</div><b id="sMax">0</b></div>
    </div>

    <div class="panel" style="margin-top:10px">
      <div><b>Guesses</b></div>
      <div id="dist"></div>
    </div>

    <div class="row" style="margin-top:10px">
      <button id="shareBtn">Share</button>
      <button class="ghost" onclick="location.reload()">Close</button>
    </div>
  </div>
</div>

<script>
// ---- daily seed & timer ----
const today = new Date();
const dayKey = today.toISOString().slice(0,10);
document.getElementById('puzzleId').textContent = "Puzzle " + dayKey;

function nextMidnight(){
  const n=new Date(); n.setHours(24,0,0,0); return n;
}
function tick(){
  const diff = nextMidnight() - new Date();
  const h=Math.floor(diff/3600000), m=Math.floor((diff%3600000)/60000), s=Math.floor((diff%60000)/1000);
  document.getElementById('timer').textContent = `Next puzzle in ${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}
setInterval(tick,1000); tick();

// deterministic RNG
let seed=[...dayKey].reduce((a,c)=>a+c.charCodeAt(0),0);
function rand(){ seed=(seed*9301+49297)%233280; return seed/233280; }

// ---- cities ----
const CITIES=[
  // US (major)
  {name:"New York",lat:40.7128,lng:-74.0060},
  {name:"Los Angeles",lat:34.0522,lng:-118.2437},
  {name:"Chicago",lat:41.8781,lng:-87.6298},
  {name:"Houston",lat:29.7604,lng:-95.3698},
  {name:"Phoenix",lat:33.4484,lng:-112.0740},
  {name:"Philadelphia",lat:39.9526,lng:-75.1652},
  {name:"San Antonio",lat:29.4241,lng:-98.4936},
  {name:"San Diego",lat:32.7157,lng:-117.1611},
  {name:"Dallas",lat:32.7767,lng:-96.7970},
  {name:"San Jose",lat:37.3382,lng:-121.8863},
  {name:"Austin",lat:30.2672,lng:-97.7431},
  {name:"Jacksonville",lat:30.3322,lng:-81.6557},
  {name:"Fort Worth",lat:32.7555,lng:-97.3308},
  {name:"Columbus",lat:39.9612,lng:-82.9988},
  {name:"Charlotte",lat:35.2271,lng:-80.8431},
  {name:"San Francisco",lat:37.7749,lng:-122.4194},
  {name:"Indianapolis",lat:39.7684,lng:-86.1581},
  {name:"Seattle",lat:47.6062,lng:-122.3321},
  {name:"Denver",lat:39.7392,lng:-104.9903},
  {name:"Washington",lat:38.9072,lng:-77.0369},
  {name:"Boston",lat:42.3601,lng:-71.0589},
  {name:"Nashville",lat:36.1627,lng:-86.7816},
  {name:"Detroit",lat:42.3314,lng:-83.0458},
  {name:"Portland",lat:45.5152,lng:-122.6784},
  {name:"Las Vegas",lat:36.1699,lng:-115.1398},
  {name:"Baltimore",lat:39.2904,lng:-76.6122},
  {name:"Milwaukee",lat:43.0389,lng:-87.9065},
  {name:"Albuquerque",lat:35.0844,lng:-106.6504},
  {name:"Tucson",lat:32.2226,lng:-110.9747},
  {name:"Fresno",lat:36.7378,lng:-119.7871},
  {name:"Mesa",lat:33.4152,lng:-111.8315},
  {name:"Sacramento",lat:38.5816,lng:-121.4944},
  {name:"Atlanta",lat:33.7490,lng:-84.3880},
  {name:"Kansas City",lat:39.0997,lng:-94.5786},
  {name:"Miami",lat:25.7617,lng:-80.1918},
  {name:"Raleigh",lat:35.7796,lng:-78.6382},
  {name:"Minneapolis",lat:44.9778,lng:-93.2650},
  {name:"New Orleans",lat:29.9511,lng:-90.0715},
  {name:"Cleveland",lat:41.4993,lng:-81.6944},
  {name:"Tampa",lat:27.9506,lng:-82.4572},
  {name:"Orlando",lat:28.5383,lng:-81.3792},
  {name:"Pittsburgh",lat:40.4406,lng:-79.9959},
  {name:"Cincinnati",lat:39.1031,lng:-84.5120},
  {name:"St. Louis",lat:38.6270,lng:-90.1994},
  {name:"Salt Lake City",lat:40.7608,lng:-111.8910},
  {name:"Honolulu",lat:21.3069,lng:-157.8583},
  {name:"Richmond",lat:37.5407,lng:-77.4360},
  {name:"Buffalo",lat:42.8864,lng:-78.8784},

  // Canada
  {name:"Toronto",lat:43.6532,lng:-79.3832},
  {name:"Vancouver",lat:49.2827,lng:-123.1207},
  {name:"Montreal",lat:45.5017,lng:-73.5673},
  {name:"Calgary",lat:51.0447,lng:-114.0719},

  // Europe / Global majors
  {name:"London",lat:51.5074,lng:-0.1278},
  {name:"Paris",lat:48.8566,lng:2.3522},
  {name:"Berlin",lat:52.52,lng:13.405},
  {name:"Rome",lat:41.9028,lng:12.4964},
  {name:"Madrid",lat:40.4168,lng:-3.7038},
  {name:"Barcelona",lat:41.3874,lng:2.1686},
  {name:"Amsterdam",lat:52.3676,lng:4.9041},
  {name:"Dublin",lat:53.3498,lng:-6.2603},

  // Asia-Pacific
  {name:"Tokyo",lat:35.6762,lng:139.6503},
  {name:"Seoul",lat:37.5665,lng:126.9780},
  {name:"Singapore",lat:1.3521,lng:103.8198},
  {name:"Hong Kong",lat:22.3193,lng:114.1694},
  {name:"Sydney",lat:-33.8688,lng:151.2093},
  {name:"Melbourne",lat:-37.8136,lng:144.9631},
  {name:"Auckland",lat:-36.8485,lng:174.7633},

  // Latin America
  {name:"Mexico City",lat:19.4326,lng:-99.1332},
  {name:"Sao Paulo",lat:-23.5558,lng:-46.6396},
  {name:"Buenos Aires",lat:-34.6037,lng:-58.3816}
];
const city=CITIES[Math.floor(rand()*CITIES.length)];

// ---- clues ----
const FALLBACK="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 800'><rect width='800' height='800' fill='%231F4E79'/></svg>";
const CLUES=[
 {emoji:"üêæ",img:"https://upload.wikimedia.org/wikipedia/commons/thumb/3/3a/Cat_on_train_seat.jpg/800px-Cat_on_train_seat.jpg",txt:"A stray animal caused a brief transit delay."},
 {emoji:"‚òïÔ∏è",img:"https://upload.wikimedia.org/wikipedia/commons/thumb/0/08/Chalkboard_menu_cafe.jpg/800px-Chalkboard_menu_cafe.jpg",txt:"A caf√© sign became a viral local meme."},
 {emoji:"üé∂",img:"https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/Federation_Square_crowd.jpg/800px-Federation_Square_crowd.jpg",txt:"An impromptu performance drew a large downtown crowd."},
 {emoji:"üéÜ",img:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5b/Suncorp_crowd_Origin_3_2022.jpg/800px-Suncorp_crowd_Origin_3_2022.jpg",txt:"A major night event packed a central venue."},
 {emoji:"üö≤",img:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/59/Bicycle_commuters.jpg/800px-Bicycle_commuters.jpg",txt:"Morning commuters crowded bike lanes across the city."},
 {emoji:"üåßÔ∏è",img:"https://upload.wikimedia.org/wikipedia/commons/thumb/7/7c/Rainy_city_street.jpg/800px-Rainy_city_street.jpg",txt:"A sudden storm flooded several streets."}
];
let chosen=[];
for(let i=0;i<4;i++){ const idx=Math.floor(rand()*CLUES.length); chosen.push(CLUES.splice(idx,1)[0]); }

// render cards
const grid=document.getElementById("grid");
chosen.forEach((c,i)=>{
 const d=document.createElement("div");
 d.className="flip";
 d.innerHTML=`<div class="flipInner">
   <div class="face front"><img src="${c.img}" onerror="this.src='${FALLBACK}'"><div class="veil"></div><div class="tag">Clue ${i+1}</div></div>
   <div class="face back"><p>${c.txt}</p></div>
 </div>`;
 d.onclick=()=>d.dataset.flipped=d.dataset.flipped==="true"?"false":"true";
 grid.appendChild(d);
});

// ---- gameplay ----
function toRad(d){return d*Math.PI/180;}
function miles(a,b,c,d){const R=3958.8;const dLat=toRad(c-a),dLon=toRad(d-b);const q=Math.sin(dLat/2)**2+Math.cos(toRad(a))*Math.cos(toRad(c))*Math.sin(dLon/2)**2;return Math.round(R*2*Math.atan2(Math.sqrt(q),Math.sqrt(1-q)));}

let guesses=[]; const MAX=5;
const count=document.getElementById("count"); const feedback=document.getElementById("feedback"); const error=document.getElementById("error");
function updateCount(){count.textContent=guesses.length+"/"+MAX+" guesses";}

function findCity(q){
  const s=q.trim().toLowerCase();
  return CITIES.find(c=>c.name.toLowerCase()===s) ||
         CITIES.find(c=>c.name.toLowerCase().startsWith(s)) || null;
}

document.getElementById("submitBtn").onclick=submitGuess;
document.getElementById("guessInput").addEventListener("keydown",e=>{ if(e.key==="Enter") submitGuess(); });

function submitGuess(){
  error.style.display="none";
  if(guesses.length>=MAX) return;
  const val=document.getElementById("guessInput").value;
  const found=findCity(val);
  if(!found){ error.style.display="block"; return; }
  const d=miles(found.lat,found.lng,city.lat,city.lng);
  guesses.push(d);
  feedback.style.display="block";
  feedback.textContent=found.name+" is "+d+" miles away.";
  updateCount();
  if(found.name===city.name || guesses.length>=MAX) finish(found.name===city.name);
  document.getElementById("guessInput").value="";
}

document.getElementById("revealBtn").onclick=()=>finish(false);

function emoji(m){if(m===0)return"üü¶";if(m<250)return"üü©";if(m<900)return"üü®";if(m<2000)return"üüß";return"‚¨õ";}

// ---- stats & streaks ----
function getStats(){
  return JSON.parse(localStorage.getItem("y_stats")||'{"played":0,"wins":0,"cur":0,"max":0,"dist":[0,0,0,0,0]}');
}
function saveStats(s){ localStorage.setItem("y_stats",JSON.stringify(s)); }

function finish(win){
  // prevent multiple finishes
  if(document.getElementById("modal").style.display==="flex") return;

  const s=getStats();
  s.played++;
  if(win){
    s.wins++;
    s.cur = (localStorage.getItem("y_last")==dayKey) ? s.cur : (s.cur+1);
    s.max = Math.max(s.max,s.cur);
    const idx=Math.min(guesses.length,5)-1; if(idx>=0) s.dist[idx]++; 
    localStorage.setItem("y_last",dayKey);
  }else{
    s.cur=0;
  }
  saveStats(s);

  const shareEmojis=chosen.map(c=>c.emoji).join("");
  const boxes=guesses.map(emoji).join("");
  const text=`YESTERDAY ${dayKey}\n${shareEmojis}\n${boxes}\n${win?"Solved":"Revealed"} ${guesses.length}/${MAX}\n${location.href}`;
  document.getElementById("modal").style.display="flex";
  document.getElementById("resultTitle").textContent=win?"Solved!":"Revealed";
  document.getElementById("streakText").textContent="Streak: "+s.cur;
  document.getElementById("shareBox").textContent=text;

  // stats UI
  document.getElementById("sPlayed").textContent=s.played;
  document.getElementById("sWin").textContent=s.played?Math.round((s.wins/s.played)*100):0;
  document.getElementById("sCur").textContent=s.cur;
  document.getElementById("sMax").textContent=s.max;
  const dist=document.getElementById("dist"); dist.innerHTML="";
  const maxBar=Math.max(1,...s.dist);
  s.dist.forEach((v,i)=>{
    const row=document.createElement("div");
    row.innerHTML=`${i+1} <div class="bar"><span style="width:${Math.round((v/maxBar)*100)}%"></span></div>`;
    dist.appendChild(row);
  });
}

document.getElementById("shareBtn").onclick=async()=>{
 const text=document.getElementById("shareBox").textContent;
 if(navigator.share){ try{ await navigator.share({text}); return;}catch(e){} }
 window.location.href="sms:?&body="+encodeURIComponent(text);
};

updateCount();
</script>
</body>
</html>
